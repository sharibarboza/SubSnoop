<div ng-include src="'views/searchnav.html'"></div>

<div class="main-content" id="user-sub-page">
  <div class="content" layout="column" ng-cloak>

    <!-- Slide out drawer showing all subreddits -->
    <div ng-include src="'views/sidenav.html'"></div>

    <div class="banner-div" style="background-color: #F5F5F5">

      <!-- Banner showing subreddit icon and other info -->
      <div class="user-banner row column-pad">
        <div class="col-md-10 col-md-push-1 col-xs-12 banner-col">
          <div class="row" style="padding-top: 20px; padding-bottom: 10px;">
            <div class="col-md-2 col-xs-12">
              <div class="profile-img">
                <img ng-if="subInfo.icon_img" lazy-img="{{ subInfo.icon_img | escape }}" class="banner-img img-circle">
                <img ng-if="!subInfo.icon_img" lazy-img="{{ '../images/logo.jpg' }}" class="banner-img img-circle">
              </div>
            </div>
            <div class="col-md-8 col-xs-12 middle-banner">
              <span class="user-name" id="{{ redditor.name }}"><strong><span class="orange">/r/</span>{{ subreddit }} <a ng-href="https://www.reddit.com/r/{{ subreddit }}" target="_blank"><button class="btn btn-xs btn-primary profile-btn">Subreddit Page <i class="fa fa-external-link" aria-hidden="true"></i></button></a></strong></span><br>
              Last seen: <time-ago class="bright-blue" from-time='{{ page == "user" ? lastPost * 1000 : latestPost * 1000 }}'></time-ago>
            </div>
            <div class="col-md-1 col-xs-6 middle-banner">
              <span class="sub-stat">{{ sub.comments.length }}</span><br>
              Comments
            </div>
            <div class="col-md-1 col-xs-6 middle-banner">
              <span class="sub-stat">{{ sub.submissions.length }}</span><br>
              Submitted
            </div>
          </div>
        </div>
      </div>

    <!-- Tab bar of navigation buttons, overviews, comments, and posts -->
      <div class="user-head-nav col-md-10 col-md-push-1 no-padding column-pad" align="center">
        <div class="col-md-2 col-sm-3 post-tab sub-tab" ng-click="setTab(3)" ng-class="tab == 3 ? 'underline-tab' : 'empty-class'"><strong class="light-gray">SUBREDDITS</strong></div>
        <div class="col-md-2 col-sm-3 col-xs-4 post-tab" ng-click="setTab(2)" ng-class="tab == 2 ? 'underline-tab' : 'empty-class'"><strong class="light-gray">OVERVIEW</strong></div>
        <div class="col-md-2 col-sm-3 col-xs-4 post-tab" ng-click="setTab(0)" ng-class="tab == 0 ? 'underline-tab' : 'empty-class'"><strong class="light-gray">COMMENTS</strong></div>
        <div class="col-md-2 col-sm-3 col-xs-4 post-tab" ng-click="setTab(1)" ng-class="tab == 1 ? 'underline-tab' : 'empty-class'"><strong class="light-gray">SUBMITTED</strong></div>
      </div>
    </div>

  </div>

  <div class="sub-table column-pad">
    <div class="no-margin row">
      <div ng-if="tab == 2" class="col-md-10 col-md-push-1 overview-body">

        <div class="row small-pad header-refresh">
          <div class="col-xs-6 no-pad"><h4><strong class="black">Overall Activity</strong></h4></div>
          <div class="col-xs-6 no-pad" align="right"><div class="btn btn-default" ng-click="refreshData()"><i class="fa fa-refresh"></i> Refresh Data</div></div>
        </div>
        <br>

        <!-- Sub banner, information, creation date, etc -->
        <div ng-include src="'views/sub-info.html'"></div>

        <!-- Sub calendar displaying post dates -->
        <div ng-include src="'views/sub-heatmap.html'"></div>

        <div align="center" id="pies" class="row no-margin">
          <div class="col-md-6 col-xs-12 no-padding" align="center">
            <md-card class="md-card-margin" style="margin-right: 0;">
              <md-card-content class="no-pad div-box left-pie-box" style="border-right: none;">
                <strong class="light-gray">SENTIMENT ANALYSIS</strong><br>
                <span class="small-font gray">Hover to see the number of posts for each category.</span>
                <donut-chart type="sentiment" sub="{{ subreddit }}" align="center"></donut-chart>
              </md-card-content>
            </md-card>
          </div>
          <div class="col-md-6 col-xs-12 no-padding" align="center">
            <md-card class="md-card-margin" style="margin-left: 0;">
              <md-card-content class="no-pad div-box right-pie-box" style="border-left: none;">
                <strong class="light-gray">VOTING FEEDBACK</strong><br>
                <span class="small-font gray">Hover to see the number of posts for each category.</span>
                <donut-chart type="reaction" sub="{{ subreddit }}" align="center"></donut-chart>
              </md-card-content>
            </md-card>
          </div>
        </div>

        <!-- Word cloud of most mentioned words in sub -->
        <div ng-include src="'views/sub-wordcloud.html'"></div>

        <br>

        <md-card class="no-pad note-card">
          <span class="small-font gray" style="font-weight: 400; margin-bottom: 10px;">Note: Since Reddit only stores the last 1000 comments and the last 1000 submissions of a user, the data shown here only represents the most recent activity since <strong ng-bind="firstPost * 1000 | amDateFormat: 'MMMM Do, YYYY'"></strong></span>
        </md-card>

        <br>
        <div align="center" class="center-back">
          <back-top></back-top>
          <br><br>
        </div>
      </div>

      <div ng-if="tab < 2">
        <!-- For displaying if there are no comments or submissions -->
        <div ng-if="tab == 0 && sub.comments.length == 0" class="col-md-10 col-md-push-1 no-padding">
          <div class="alert alert-secondary">{{ username }} has no comments in {{ subreddit }}.</div>
        </div>
        <div ng-if="tab == 1 && sub.submissions.length == 0" class="col-md-10 col-md-push-1 no-padding">
          <div class="alert alert-secondary">{{ username }} has no submissions in {{ subreddit }}.</div>
        </div>

        <!-- Left column for displaying posts -->
        <div ng-if="(tab == 0 && sub.comments.length > 0) || (tab == 1 && sub.submissions.length > 0)" class="col-md-10 col-md-push-1 post-body">

          <div class="post-page">
            <div class="row no-margin header-refresh">
              <div class="col-xs-6 no-pad"><h4><strong class="black">{{ tab == 0 ? 'Comments' : 'Submissions' }}</strong></h4></div>
              <div class="col-xs-6 no-pad" align="right"><div class="btn btn-default" ng-click="refreshData()"><i class="fa fa-refresh"></i> Refresh Data</div></div>
            </div>
            <br>

            <div class="row no-margin" id="table-start">

              <!-- Dropdown menu for sorting posts -->
              <div class="col-md-2 col-sm-3 col-xs-6 no-padding dropdown-left-col">
                <div class="btn-group select-dropdown">
                  <button type="button" class="form-control btn btn-default dropdown-toggle" data-toggle="dropdown">
                    {{ sortSelected.name }}
                  </button>
                  <ul class="dropdown-menu" role="menu">
                    <li ng-repeat="sort in data.sortOptions" ng-click="setSortOption(sort)">{{ sort.name }}</li>
                  </ul>
                </div>
              </div>

              <!-- Dropdown menu for displaying the number of posts -->
              <div class="col-md-2 col-sm-3 col-xs-6 no-padding dropdown-right-col">
                <div class="btn-group select-dropdown">
                  <button type="button" class="form-control btn btn-default dropdown-toggle" data-toggle="dropdown">
                    View {{ subPage.items }}
                  </button>
                  <ul class="dropdown-menu" role="menu">
                    <li ng-repeat="view in views" ng-click="setItemsPerPage(view)">View {{ view }}</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="row small-pad">

              <!-- Display the number of current posts shown -->
              <div class="col-md-6 viewing-row">
                <span class="small-font viewing-title">Viewing <strong class="orange">{{ slicedArray.length }}</strong> of {{ sub[tabOptions[tab]].length }} {{ tabOptions[tab] }} </span>
              </div>

              <!-- Top Pagination -->
              <div class="col-md-6 no-padding paginate" align="right" id="top-paginate">
                <pagination ng-change="setArray()" total-items="sub[tabOptions[tab]].length" ng-model="subPage.current" class="pagination-sm" items-per-page="subPage.items" max-size="subPage.max" style="margin: -5px;"></pagination>
              </div>
            </div>
          </div>
          <br>

          <div id="{{ tabOptions[tab] }}">

            <!-- Display list of posts (comment or submission) -->
            <div ng-repeat="element in slicedArray" class="comment-list">
              <div ng-if="element.type == 'comment'">
                <div ng-include src="'views/comment-no-title.html'"></div>
              </div>
              <div ng-if="element.type == 'submit'">
                <div ng-include src="'views/submission.html'"></div>
              </div>
            </div>
            <div class="row bottom-pag">
              <br>
              <div align="center" class="center-back">
                <back-top></back-top>
                <br><br>
              </div>

              <!-- Bottom pagination -->
              <div class="no-padding" align="center">
                <pagination ng-change="setArray(1)" total-items="sub[tabOptions[tab]].length" ng-model="subPage.current" class="pagination-sm" items-per-page="subPage.items" max-size="subPage.max" id="bottom-paginate"></pagination>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>
