<div ng-include src="'views/searchnav.html'"></div>

<div class="main-content" id="user-sub-page">
  <div class="content" layout="column" ng-cloak>

    <div ng-include src="'views/sidenav.html'"></div>

    <div class="banner-div">
      <div class="user-banner row" align="center">
        <div class="user-page">
          <div class="avatar-header">
            <div class="post-wing left-wing" align="center" style="border-right: 1px solid #C3D5DB;">
              {{ sub.comments.length }}
              <br>
              <strong>Comments</strong>
            </div>
            <div class="profile-img">
              <img ng-if="subInfo.icon_img" ng-src="{{ subInfo.icon_img }}" class="banner-img img-circle">
              <img ng-if="!subInfo.icon_img" ng-src="{{ '../images/sub-icon.png' }}" class="banner-img img-circle">
            </div>
            <div class="post-wing right-wing" align="center" style="border-left: 1px solid #C3D5DB;">
              {{ sub.submissions.length }}
              <br>
              <strong>Submitted</strong>
            </div>
          </div>
          <span class="user-name" id="{{ redditor.name }}"><strong><span class="baby-blue2">/r/</span>{{ subreddit }}</strong></span>
          <br>
          <span class="badge num-subs">{{ username }}</span>
          <br><br>
          Current data from: <span class="bright-blue" ng-bind="firstPost.created_utc * 1000 | amDateFormat: 'MMMM Do YYYY, h:mm a'"></span>
        </div>
      </div>
    </div>

    <div class="user-head-nav" align="center">
      <div class="col-xs-3 no-padding" align="left">
        <a ng-href="#/{{ username }}"><md-button class="md-raised md-primary visit-btn no-margin"><i class="fa fa-arrow-left" aria-hidden="true"></i> Back to subs <i class="fa fa-list" aria-hidden="true"></i></i></md-button></a>
      </div>
      <div class="col-xs-2 post-tab" ng-click="setTab(2)" ng-class="tab == 2 ? 'underline-tab' : 'empty-class'"><strong class="light-gray">Overview</strong></div>
      <div class="col-xs-2 post-tab" ng-click="setTab(0)" ng-class="tab == 0 ? 'underline-tab' : 'empty-class'"><strong class="light-gray">Comments</strong></div>
      <div class="col-xs-2 post-tab" ng-click="setTab(1)" ng-class="tab == 1 ? 'underline-tab' : 'empty-class'"><strong class="light-gray">Posts</strong></div>
      <div class="col-xs-3 no-padding" align="right">
        <a ng-href="https://www.reddit.com/r/{{ subreddit }}"><md-button class="md-raised md-primary visit-btn no-margin"><i class="fa fa-reddit-alien" aria-hidden="true"></i> To Reddit page <i class="fa fa-external-link" aria-hidden="true"></i></i></md-button></a>
      </div>
    </div>

    <div class="sub-table">
      <div class="sub-rows" id="table-head">

        <div ng-if="tab == 2">
          <div id="overview">

            <div class="row no-margin">
              <div class="col-md-6 no-padding">
                <md-card>
                  <md-card-content>
                    <div ng-if="subInfo.banner_img" class="banner-box">
                      <img ng-src="{{ subInfo.banner_img }}" class="sub-banner-img" />
                      <div class="banner-text">
                        <span class="txt-block">Subscribers: <span class="non-bg baby-blue">{{ subInfo.subscribers | number }}</span></span>
                      </div>
                    </div>
                    <div><strong class="light-gray">ABOUT THIS SUBREDDIT</strong>
                    <br>
                    <p ng-if="subInfo.public_description" ng-bind-html="subInfo.public_description_html | sanitize"></p></div>
                    <p ng-if="!subInfo.public_description">No description available.</p>
                  </md-card-content>
                  <md-divider></md-divider>
                  <md-card-content>
                    <div ng-if="!subInfo.banner_img">
                      <strong class="dark-gray"><i class="fa fa-user-plus" aria-hidden="true"></i>  Subscribers:
                      <span class="baby-blue">{{ subInfo.subscribers | number }}</span></strong>
                    </div>
                    <strong class="dark-gray"><i class="fa fa-calendar" aria-hidden="true"></i>  Created:
                    <span class="green" ng-bind="subInfo.created_utc * 1000 | amDateFormat: 'MMMM Do YYYY, h:mm a'"></span></strong>
                 </md-card-content>
                </md-card>
              </div>
              <div class="col-md-6 no-padding">
                <md-card>
                  <md-card-content>
                    <strong class="light-gray">{{ username | uppercase }}'S ACTIVITY IN {{ subreddit | uppercase }}</strong>
                    <br>
                    <strong class="dark-gray"><i class="fa fa-clock-o" aria-hidden="true"></i>  Last seen:
                    <time-ago class="green" from-time='{{ latestPost.created_utc * 1000 }}'></time-ago></strong>
                  </md-card-content>
                  <md-divider></md-divider>
                  <md-card-content>
                    <div class="row" id="overview-table">
                      <div class="col-sm-12">
                        <table class="table">
                          <tr class="table-heads blue-bg">
                            <th class="col-xs-3"></th>
                            <th class="col-xs-3">Comments</th>
                            <th class="col-xs-3">Submitted</th>
                            <th class="col-xs-3">Total</th>
                          </tr> 
                          <tr>
                            <th class="dark-gray"><i class="glyphicon glyphicon-pencil icon-gray" aria-hidden="true"></i>  Posts</th>
                            <td>{{ sub.comments.length }}</td>
                            <td>{{ sub.submissions.length }}</td>
                            <td>{{ (sub.comments.length) + (sub.submissions.length) | number }}</td>
                          </tr>
                          <tr>
                            <th class="dark-gray"><i class="glyphicon glyphicon-star icon-gray" aria-hidden="true"></i>  Gilded</th>
                            <td>{{ sub.gilded_comments }}</td>
                            <td>{{ sub.gilded_submissions }}</td>
                            <td>{{ (sub.gilded_comments) + (sub.gilded_submissions) | number }}</td>
                          </tr>  
                          <tr>
                            <th class="dark-gray"><i class="glyphicon glyphicon-arrow-up icon-gray" aria-hidden="true"></i>  Upvotes</th>
                            <td>{{ sub.comment_ups | number }}</td>
                            <td>{{ sub.submission_ups | number }}</td>
                            <td>{{ (sub.comment_ups) + (sub.submission_ups) | number }}</td>
                          </tr>    
                        </table>    
                        <span class="gray small-font">Note: The data shown here is only a portion from the the user's more recent 1000 comments and most recent 1000 submissions from all subreddits.</span>
                      </div>
                    </div>
                  </md-card-content>
                </md-card>
              </div>
            </div>
          </div>

          <br>

          <div class="heatmap" ng-controller="HeatmapCtrl">
            <md-card>
              <md-card-content>
                <h4><strong>Post Activity This Year</strong></h4>
                <p class="gray small-font">Hover over a circle to see the number of comments and submissions posted on that day.</p>
                <br>
                <calendar-heatmap data="mapData" color="'#05753B'" overview="'year'" handler="print"></calendar-heatmap>
             </md-card-content>
            </md-card>
          </div>

          <br>
          <div id="statistics" ng-controller="SubStatsCtrl">

            <strong class="stats-title" style="padding-left: 10px;">Out of {{ username }}'s <span class="badge">{{ subLength }}</span> subreddits, <span class="purple">/r/{{ subreddit }}</span> is:</strong>
            <div class="row badge-row small-font">
              <div ng-repeat="(badge, data) in badges" class="col-sm-3 col-xs-6" align="center">
                <md-card>
                  <br>
                  <img ng-src="{{ data.image }}" class="stat-icon">
                  <md-card-content>
                    <strong class="green" ng-class="{ 'md-blue' : data.rank > 5, 'green' : data.rank == 1, 'baby-blue' : data.rank < 5 && data.rank > 1 }">Ranked #{{ data.rank }}</strong>
                  </md-card-content>
                  <md-divider></md-divider>
                  <md-card-actions layout="row" layout-align="center">
                    <h5 class="light-gray"><strong>{{ data.name }}</strong></h5>
                  </md-card-actions>                
                </md-card>
              </div>             
            </div>

            <br>
            <div class="row no-margin">
              <div ng-repeat="element in highestPosts" ng-if="element.id" class="col-md-6 col-xs-12 no-padding">
                <div ng-if="element.type == 'comment'">
                  <div ng-include src="'views/comment.html'"></div>
                </div>
                <div ng-if="element.type == 'submit'">
                  <div ng-include src="'views/submission.html'"></div>
                </div>
                <br>
              </div>
            </div>
          </div>

          <div ng-controller="WordcloudCtrl" class="border-box">
            <md-card>
              <md-card-content>
                <h4><strong>Words in r/{{ subreddit }}</strong></h4>
                <div align="center">
                  <jqcloud words="words" steps="7" colors="{{ colors }}" style="width: 90%; height: 350px;"></jqcloud>
                </div>
              </md-card-content>
            </md-card>
          </div>

          <br>
          <div align="center" class="center-back">
            <back-top></back-top>
            <br><br>
          </div>
        </div>

        <div ng-if="(tab == 0 && sub.comments.length > 0) || (tab == 1 && sub.submissions.length > 0)">
          <div class="margin-pad">
            <span class="small-font">Viewing <strong class="orange">{{ slicedArray.length }}</strong> of {{ sub[tabOptions[tab]].length }} {{ tabOptions[tab] }} </span>
            <div class="table-options">
              <div class="row" id="table-start">
                <div class="col-md-3">               
                  <div class="btn-group select-dropdown">
                    <button type="button" class="form-control btn btn-default dropdown-toggle" data-toggle="dropdown">
                      {{ sortSelected.name }}
                    </button>
                    <ul class="dropdown-menu" role="menu">
                      <li ng-repeat="sort in data.sortOptions" ng-click="setSortOption(sort)">{{ sort.name }}</li>
                    </ul>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="btn-group select-dropdown">
                    <button type="button" class="form-control btn btn-default dropdown-toggle" data-toggle="dropdown">
                      View {{ subPage.items }}
                    </button>
                    <ul class="dropdown-menu" role="menu">
                      <li ng-repeat="view in views" ng-click="setItemsPerPage(view)">{{ view }}</li>
                    </ul>
                  </div>
                </div>
                <div class="col-md-6 paginate" align="right" id="top-paginate">
                  <pagination total-items="sub[tabOptions[tab]].length" ng-model="subPage.current" class="pagination-sm" items-per-page="subPage.items" max-size="subPage.max" style="margin: -5px;"></pagination>
                </div>
              </div>
            </div>
          </div>
          <br>

          <div id="{{ tabOptions[tab] }}">
            <div ng-repeat="element in sliceArray()">
              <div ng-if="element.type == 'comment'">
                <div ng-include src="'views/comment.html'"></div>
              </div>
              <div ng-if="element.type == 'submit'">
                <div ng-include src="'views/submission.html'"></div>
              </div>
            </div>
            <div class="row bottom-pag">
              <div class="col-md-6 pull-center no-padding" id="back-up">
                <back-top></back-top>
              </div>
              <div class="col-md-6 paginate no-padding">
                <pagination total-items="sub[tabOptions[tab]].length" ng-model="subPage.current" ng-change="backUp()" class="pagination-sm" items-per-page="subPage.items" max-size="subPage.max" id="bottom-paginate"></pagination>
              </div>
            </div>
          </div>
        </div>

        <div ng-if="tab == 0 && sub.comments.length == 0" class="no-posts margin-pad">
          <h4 class="light-gray">{{ username }} has no comments in {{ subreddit }}.</h4>
        </div>
        <div ng-if="tab == 1 && sub.submissions.length == 0" class="no-posts margin-pad">
          <h4 class="light-gray">{{ username }} has no submissions in {{ subreddit }}.</h4>
        </div>
      </div>
    </div>

  </div>
</div>

