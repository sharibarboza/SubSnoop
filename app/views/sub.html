<div ng-include src="'views/searchnav.html'"></div>

<div class="main-content" id="user-sub-page">
  <div class="content" layout="column" ng-cloak>

    <div ng-include src="'views/sidenav.html'"></div>

    <div class="banner-div">
      <div class="user-banner sub-banner row">
        <div class="col-md-8 col-md-push-3 user-page">
          <div class="row">
            <div class="col-sm-7">
              <span class="reddit-name shadow-text"><span class="baby-blue">/r/</span>{{ subreddit }}</span>
            </div>
            <div class="col-sm-5 badge-col">
              <span class="badge num-subs">{{ username }}</span>
            </div>
          </div>
          <div class="row banner-subtext">
            <div class="col-md-7 col-xs-12">
              <strong class="shadow-text">Data from: <span class="bright-blue" ng-bind="firstPost.created_utc * 1000 | amDateFormat: 'MMMM Do YYYY, h:mm a'"></span></strong>
            </div>
            <div class="col-md-5 col-xs-12 right-box">
              <div class="shadow-text"><i class="fa fa-clock-o" aria-hidden="true"></i> <strong class="white">Last seen: <time-ago class="bright-blue" from-time='{{ latestPost.created_utc * 1000 }}'></time-ago></strong></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="user-head-nav" align="center">
      <div class="col-xs-4" ng-click="switchSub()"><p ng-class="tab == 2 ? 'green' : 'text-gray'">{{ isOverview() ? "Subs" : "Overview" }}</p></div>
      <div class="col-xs-4" ng-click="setTab(0)"><p ng-class="tab == 0 ? 'green' : 'text-gray'">Comments</p></div>
      <div class="col-xs-4" ng-click="setTab(1)"><p ng-class="tab == 1 ? 'green' : 'text-gray'">Posts</p></div>
    </div>

    <div class="sub-table">
      <div ng-include src="'views/sub-sidebar.html'"></div>
      <div class="col-md-8 col-md-push-3 col-xs-12 sub-rows" id="table-head">

        <div ng-if="tab == 2">
          <div id="overview">

            <div ng-if="subInfo.banner_img" class="banner-box">
              <img ng-src="{{ subInfo.banner_img }}" class="sub-banner-img" />
              <div class="banner-text">
                <span>Subscribers: <span class="non-bg baby-blue">{{ subInfo.subscribers | number }}</span></span><br>
                <span>Subreddit since: <span class="non-bg green" ng-bind="subInfo.created_utc * 1000 | amDateFormat: 'MMMM Do YYYY, h:mm a'"></span></span>
              </div>
            </div>
            <div ng-if="subInfo.public_description"><strong>About this subreddit:</strong> <p ng-bind-html="subInfo.public_description_html | sanitize"></p></div>
            <div ng-if="!subInfo.banner_img">
              <strong>Subscribers: <span class="baby-blue">{{ subInfo.subscribers | number }}</span></strong><br>
              <strong>Subreddit since: <span class="green" ng-bind="subInfo.created_utc * 1000 | amDateFormat: 'MMMM Do YYYY, h:mm a'"></span></strong>
            </div>
            <hr>

            <div class="row" id="overview-table">
              <div class="col-sm-12">
                <table class="table table-bordered">
                  <tr class="table-heads">
                    <th class="col-xs-3"></th>
                    <th class="col-xs-3">Comments</th>
                    <th class="col-xs-3">Submitted</th>
                    <th class="col-xs-3">Total</th>
                  </tr>
                  <tr>
                    <th>Posts</th>
                    <td>{{ sub.comments.length }}</td>
                    <td>{{ sub.submissions.length }}</td>
                    <td>{{ (sub.comments.length) + (sub.submissions.length) | number }}</td>
                  </tr>
                  <tr>
                    <th>Gilded</th>
                    <td>{{ sub.gilded_comments }}</td>
                    <td>{{ sub.gilded_submissions }}</td>
                    <td>{{ (sub.gilded_comments) + (sub.gilded_submissions) | number }}</td>
                  </tr> 
                  <tr>
                    <th>Upvotes</th>
                    <td>{{ sub.comment_ups | number }}</td>
                    <td>{{ sub.submission_ups | number }}</td>
                    <td>{{ (sub.comment_ups) + (sub.submission_ups) | number }}</td>
                  </tr>      
                </table>    
              </div>
            </div>

          </div>

          <div id="statistics" ng-controller="SubStatsCtrl">
            <div class="row badge-row small-font">

              <div align="center">
                <h4>Out of {{ username }}'s <strong class="orange">{{ subLength }}</strong> subreddits, <span class="baby-blue">r/{{ subreddit }}</span> is ranked:</h4>
              </div>

              <div class="col-sm-3 col-xs-6" align="center">
                <img ng-src="{{ '../images/active.png' }}" class="stat-icon"><br>
                <strong class="green">#{{ mostActiveRank }} in most active</strong>
              </div>
              <div class="col-sm-3 col-xs-6" align="center">
                <img ng-src="{{ '../images/best.png' }}" class="stat-icon"><br>
                <strong class="green">#{{ mostUpsRank }} in most upvoted</strong>
              </div>
               <div class="col-sm-3 col-xs-6" align="center">
                <img ng-src="{{ '../images/comments.png' }}" class="stat-icon"><br>
                <strong class="green">#{{ mostCommentsRank }} in most comments</strong>
              </div>  
               <div class="col-sm-3 col-xs-6" align="center">
                <img ng-src="{{ '../images/posts.png' }}" class="stat-icon"><br>
                <strong class="green">#{{ mostSubmitsRank }} in most submitted</strong>
              </div>               
            </div>

            <br>
            <div ng-repeat="element in highestPosts" ng-if="element.id">
              <div class="card side-cards">
                <div class="card-content card-heading">
                  <i class="fa fa-star-o purple" aria-hidden="true"></i> {{ element.type == 'comment' ? 'Most Upvoted Comment' : 'Most Upvoted Submission' }}
                </div>
              </div>
              <div ng-if="element.type == 'comment'">
                <div ng-include src="'views/comment.html'"></div>
              </div>
              <div ng-if="element.type == 'submit'">
                <div ng-include src="'views/submission.html'"></div>
              </div>
            </div>
          </div>

          <div class="heatmap border-box" ng-controller="HeatmapCtrl">
            <h4><strong>Post Activity This Year</strong></h4>
            <p ng-if="showNote(firstPost)" class="gray small-font">Note: The data here is only available since <span class="purple" ng-bind="firstPost.created_utc * 1000 | amDateFormat: 'MMMM Do YYYY'"></span>, because the user's posts from all subreddits are capped out at the most recent 1000 comments and submissions each.</p>
            <calendar-heatmap data="mapData" color="'#05753B'" overview="'year'" handler="print"></calendar-heatmap>
          </div>

          <br>
          <div ng-controller="WordcloudCtrl" class="border-box">
            <h4><strong>Words in r/{{ subreddit }}</strong></h4>
            <div align="center">
              <jqcloud words="words" steps="7" colors="{{ colors }}" style="width: 90%; height: 350px;"></jqcloud>
            </div>
          </div>

          <br>
          <div align="center" class="center-back">
            <back-top></back-top>
            <br><br>
          </div>
        </div>

        <div ng-if="(tab == 0 && sub.comments.length > 0) || (tab == 1 && sub.submissions.length > 0)">
          <span class="small-font">Viewing <strong class="orange">{{ slicedArray.length }}</strong> of {{ sub[tabOptions[tab]].length }} {{ tabOptions[tab] }} </span>
          <div class="table-options">
            <div class="row" id="table-start">
              <div class="col-md-3">               
                <div class="btn-group select-dropdown">
                  <button type="button" class="form-control btn btn-default dropdown-toggle" data-toggle="dropdown">
                    {{ sortSelected.name }}
                  </button>
                  <ul class="dropdown-menu" role="menu">
                    <li ng-repeat="sort in data.sortOptions" ng-click="setSortOption(sort)">{{ sort.name }}</li>
                  </ul>
                </div>
              </div>
              <div class="col-md-3">
                <div class="btn-group select-dropdown">
                  <button type="button" class="form-control btn btn-default dropdown-toggle" data-toggle="dropdown">
                    View {{ subPage.items }}
                  </button>
                  <ul class="dropdown-menu" role="menu">
                    <li ng-repeat="view in views" ng-click="setItemsPerPage(view)">{{ view }}</li>
                  </ul>
                </div>
              </div>
              <div class="col-md-6 paginate" align="right" id="top-paginate">
                <pagination total-items="sub[tabOptions[tab]].length" ng-model="subPage.current" class="pagination-sm" items-per-page="subPage.items" max-size="subPage.max" style="margin: -5px;"></pagination>
              </div>
            </div>
          </div>
          <br>

          <div id="{{ tabOptions[tab] }}">
            <div ng-repeat="element in sliceArray()">
              <div ng-if="element.type == 'comment'">
                <div ng-include src="'views/comment.html'"></div>
              </div>
              <div ng-if="element.type == 'submit'">
                <div ng-include src="'views/submission.html'"></div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 pull-center" id="back-up">
                <back-top></back-top>
              </div>
              <div class="col-md-6 paginate">
                <pagination total-items="sub[tabOptions[tab]].length" ng-model="subPage.current" ng-change="backUp()" class="pagination-sm" items-per-page="subPage.items" max-size="subPage.max" id="bottom-paginate"></pagination>
              </div>
            </div>
          </div>
        </div>

        <div ng-if="tab == 0 && sub.comments.length == 0" align="center">
          <h5>{{ username }} has no comments in r/{{ subreddit }}.</h5>
        </div>
        <div ng-if="tab == 1 && sub.submissions.length == 0" align="center">
          <h5>{{ username }} has no submissions in r/{{ subreddit }}.</h5>
        </div>
      </div>
    </div>

  </div>
</div>

