<div ng-include src="'views/searchnav.html'"></div>

<!-- Display not found page -->
<div id="not-found" ng-if="notfound" ng-include src="'views/not-found.html'"></div>

<div class="main-content" id="home-page">

  <div ng-if="!notfound" class="content" layout="column" ng-cloak>

    <!-- Open slideable bar to display subreddits -->
    <div ng-include src="'views/sidenav.html'" id="fixed-sidebar"></div>

    <div ng-if="noSubs" align="center" class="banner-div" id="not-found-div">
      <h3 class="sub-banner">{{ username }} does not have any activity yet.</h3>
      <br>
    </div>

    <div ng-if="!noSubs" class="banner-div" style="background-color: #F5F5F5">

      <!-- User banner containing profile picture, and other user info -->
      <div class="user-banner row column-pad">
        <div class="col-md-10 col-md-push-1 col-xs-12 banner-col">
          <div class="row" style="padding-top: 20px; padding-bottom: 10px;">
            <div class="col-md-2 col-xs-12">
              <div class="profile-img">
                <img ng-if="redditor.subreddit" lazy-img="{{ redditor.subreddit.icon_img | escape }}" class="banner-img img-circle">
                <img ng-if="!redditor.subreddit" lazy-img="{{ redditor.icon_img }}" class="banner-img img-circle">
              </div>
            </div>
            <div class="col-md-7 col-xs-12 middle-banner">
              <span class="user-name" id="{{ redditor.name }}"><strong><span class="orange">/u/</span>{{ redditor.name }} <a ng-href="https://www.reddit.com/u/{{ redditor.name }}" target="_blank"><button class="btn btn-xs btn-primary profile-btn">Reddit Profile <i class="fa fa-external-link" aria-hidden="true"></i></button></a></strong></span><br>
              Joined Reddit on: <span class="bright-blue" ng-bind="redditor.created_utc * 1000 | amDateFormat: 'MMMM Do YYYY'"></span>
            </div>
            <div class="col-md-1 col-xs-4 middle-banner">
              <span class="sub-stat">{{ subLength }}</span><br>
              Subreddits
            </div>
            <div class="col-md-1 col-xs-4 middle-banner">
              <span class="sub-stat">{{ comments }}</span><br>
              Comments
            </div>
            <div class="col-md-1 col-xs-4 middle-banner">
              <span class="sub-stat">{{ submissions }}</span><br>
              Submitted
            </div>
          </div>
        </div>
      </div>

      <!-- Tab bar of navigation buttons, overviews, comments, and posts -->
      <div class="user-head-nav col-md-10 col-md-push-1 no-padding column-pad" align="center">
        <div class="col-md-2 col-xs-6 post-tab" ng-click="setTab(0)" ng-class="tab == 0 ? 'underline-tab' : 'empty-class'"><strong class="light-gray">SUBREDDITS</strong></div>
        <div class="col-md-2 col-xs-6 post-tab" ng-click="setTab(1)" ng-class="tab == 1 ? 'underline-tab' : 'empty-class'"><strong class="light-gray">STATS</strong></div>
        </div>
      </div>

      <div class="sub-table column-pad">
        <div class="no-margin row">

          <!-- Main left column -->
          <div ng-if="tab == 0" class="col-md-10 col-md-push-1 no-padding" id="table-head" ng-controller="UserStatsCtrl">
            <div id="subreddits" class="margin-pad">

              <div class="row header-refresh">
                <div class="col-xs-6 no-pad"><h4><strong class="black">Ranked Subreddits</strong></h4></div>
                <div class="col-xs-6 no-pad" align="right"><div class="btn btn-default" ng-click="refreshData()"><i class="fa fa-refresh"></i> Refresh Data</div></div>
              </div>
              <br>

              <!-- Row displaying sorting dropdown menu -->
              <div class="row" id="subtable-head">
                <div class="col-md-1 hidden-sm hidden-xs sort-header placeholder-gray" align="center">Sort</div>
                <div class="col-md-3 col-sm-6 col-xs-12 dropdown-col no-left-pad" id="sort-dropdown">
                  <div class="btn-group select-dropdown">
                    <button type="button" class="form-control sort-dropdown btn btn-default dropdown-toggle" data-toggle="dropdown">
                      <strong class="placeholder-gray">{{ selected.name }}</strong>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                      <li ng-repeat="sort in sortData.sortOptions" ng-click="setSortOption(sort)">{{ sort.name }}</li>
                    </ul>
                  </div>
                </div>
                <div class="col-md-3 col-sm-6 col-xs-12 search-sub-col no-right-pad">
                  <form>
                    <input type="text" id="testInput" class="form-control"
                           ng-model="searchSub" ng-change="changeSubs(searchSub)" placeholder="&#xF002; Search for a sub ..." style="font-family: FontAwesome, Helvetica Neue;" md-autofocus>
                  </form>
                </div>
              </div>

              <!-- Row displaying subreddit search input -->
              <br>
              <div class="row table-header table-subtext gray">
                <div class="col-md-1 col-sm-1 col-xs-2" align="center">Rank</div>
                <div class="col-md-5 col-sm-5 col-xs-10">Subreddit</div>
                <div class="col-md-2 hidden-sm hidden-xs">Last Seen</div>
                <div class="col-md-1 col-sm-2 hidden-xs">Comments</div>
                <div class="col-md-1 col-sm-2 hidden-xs">Submitted</div>
                <div class="col-md-1 col-sm-2 hidden-xs">Points</div>
                <div class="col-md-1 hidden-sm hidden-xs">Avg. Points</div>
              </div>
              <!-- Subreddits table -->
              <div ng-repeat="subreddit in subList" id="sub-row">
                <a ng-href="#/{{ username }}/{{ subreddit }}/">
                <md-card>
                  <md-card-title class="sub-box">
                    <div class="col-md-1 col-sm-1 col-xs-2 rank-box subname-box" align="center">{{ 1 + $index }}</div>
                    <div class="col-md-5 col-sm-5 col-xs-10 subname-box">
                      <span class="sub-name">{{ subreddit }} <span ng-if="subs[subreddit].gilded_comments > 0 || subs[subreddit].gilded_submissions > 0" class="gilded-icon gilded-sub"></span> </span>

                      <span ng-if="subreddit == tableBadges.mostActive.sub" class="sub-badge" id="most-active">Most Activity</span>
                      <span ng-if="subreddit == tableBadges.newestSub.sub" class="sub-badge" id="newest">Newest</span>
                      <span ng-if="subreddit == tableBadges.lastSeen.sub" class="sub-badge" id="last-seen">Last Seen</span>
                      <span ng-if="subreddit == topComment" class="sub-badge" id="best-comment">Best Comment</span>
                      <span ng-if="subreddit == topSubmit" class="sub-badge" id="best-submit">Best Post</span>
                      <span ng-if="subreddit == tableBadges.avgPost.sub" class="sub-badge" id="best-avg">Best Average</span>
                    </div>
                    <div class="col-md-2 hidden-sm hidden-xs subname-box" ng-init="seen=subs[subreddit].recent_activity.created_utc * 1000">
                      <span class="sub-text"><time-ago from-time='{{ seen }}'></time-ago></span>
                    </div>
                    <div class="col-md-1 col-sm-2 hidden-xs subbox-stats subname-box">
                      <span class="black">{{ subs[subreddit].comments.length }}</span>
                    </div>
                    <div class="col-md-1 col-sm-2 hidden-xs subbox-stats subname-box">
                      <span class="black">{{ subs[subreddit].submissions.length }}</span>
                    </div>
                    <div class="col-md-1 col-sm-2 hidden-xs subbox-stats subname-box">
                      <span ng-class="subs[subreddit].total_ups > 0 ? 'green' : 'orange'">{{ subs[subreddit].total_ups | number }}</span>
                    </div>
                    <div class="col-md-1 hidden-sm hidden-xs subbox-stats subname-box">
                      <span ng-class="black">{{ subs[subreddit].avg_karma | number : 2 }}</span>
                    </div>
                  </md-card-title>
                </md-card>
                </a>
              </div>
            </div>

            <br>
            <div align="center" class="center-back">
              <back-top></back-top>
              <br><br>
            </div>

          </div>

          <div ng-if="tab == 1" class="col-md-10 col-md-push-1 no-padding">
            <div class="row margin-pad header-refresh">
              <div class="col-xs-6 no-pad"><h4><strong class="black">Subreddit Stats</strong></h4></div>
              <div class="col-xs-6 no-pad" align="right"><div class="btn btn-default" ng-click="refreshData()"><i class="fa fa-refresh"></i> Refresh Data</div></div>
            </div>
            <br>

            <div id="statistics" ng-controller="UserStatsCtrl" align="center">
              <div class="row no-margin" style="width: 80%;">
                <div ng-repeat="(badge, data) in badges" class="col-md-3 col-xs-6 no-padding" align="center">
                  <a href="#/{{ username }}/{{ data.sub }}/">
                  <md-card class="user-badge-card no-margin">
                    <md-tooltip class="tooltip">{{ data.sub }}: {{ data.points | number }} <ng-pluralize count="data.points" when="{'1': 'point', 'other': 'points'}"></ng-pluralize></md-tooltip>
                    <br>
                    <img lazy-img="{{ data.image ? data.image : '../images/logo.jpg' }}" class="badge-image img-circle" alt="badge">
                    <strong><span class="baby-blue">/r/</span>{{ data.sub | truncate:25:true }}</strong>
                    <strong class="light-gray">{{ data.name }}</strong>
                    <br>
                  </md-card>
                  </a>
                </div>
              </div>
              <br>
              <hr>

            </div>

            <!-- Subreddit activity heat map -->
            <div ng-include src="'views/user-heatmap.html'"></div>

            <md-card class="no-pad note-card">
              <span class="small-font gray">Note: Reddit only stores the last 1000 comments and the last 1000 submissions of a user.</span>
            </md-card>

            <br>
            <div align="center" class="center-back">
              <back-top></back-top>
              <br><br>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>
</div>
